#RetroDevStudio.MetaData.BASIC:7169,BASIC V7.0 VDC,uppercase,10,10
# U4 OPENING SEQUENCE
# PART #1

10 GRAPHIC 0
20 PRINT "WELCOME TO THE ULTIMA 4 INTRO":PRINT

# LOOKUP TABLE - PIXEL IN BYTE
30 DIM XL(7)
40 FOR X=0 TO 7
50  XL(X)=2X
60 NEXT
# LOOKUP TABLE - BYTE OFFSET OF ROW
70 DIM YL(200)
80 FOR Y=0 TO 199
90  YL(Y)=Y*80
100 NEXT

110 DEF FN W(ZZ)=PEEK(ZZ)+PEEK(ZZ+1)*256
120 BS=FN W(45)
130 BE=FN W(4624)
#  DB:DATA BEGIN
#  DE:DATA END
140 DB=BE+1:DE=DB+8000

150 PRINT "BASIC FROM "BS" TO "BE"."
160 PRINT "LEAVES "FRE(0)" BYTES FREE FOR DATA."


170 DD=PEEK(186)
190 BLOAD"VDCBASIC2C.0AC6",U(DD),B0:SYS DEC("AC6")

200 RGO 28,2 4:REM 64K VRAM
210 RGO 25,128:REM BITMAP MODE ON

# 2 SCANLINES PER CHAR, 156 SCANLINES (EACH VAL +1)
220 RGW 0,127:RGW 4,155:RGW 6,100:RGW 7,140:RGW 9,1
230 RGW 36,0

#AS:ATTRIBUTE SOURCE
#AD:ATTRIBUTE DESTINATION
240 AS=40000:AD=16000

#PS:PIXEL SOURCE
#PD:PIXEL DESTINATION
250 PS=24000:PD=0

#RW:ROW WIDTH
260 RW=80

270 DISP 0:ATTR AD
280 VMF 0,0,16000: REM CLEAR SCREEN-RAM (ALL PIXELS TO BG-COLOR)
290 VMF 16000,DEC("0F"),8000: REM SETUP ATTRIBUTE-RAM (BLACK/WHITE AS BG/FG COLORS FOR ALL PIXELS)

300 PF$="TITLE.VDC"
310 BLOAD (PF$),U(DD),P(DB),B0
320 RTV DB,24000,24000


#210 GOTO 1600

# COORDINATES FOR "QUEST OF THE AVATAR" ANIMATION
330 DIM IA(1,5)
340 IA(0,0)=0:IA(0,1)=0:IA(0,2)=1:IA(0,3)=1:IA(0,4)=2:IA(0,5)=2
350 IA(1,0)=0:IA(1,1)=1:IA(1,2)=1:IA(1,3)=2:IA(1,4)=2:IA(1,5)=3


360 VMF 0,0,16000: REM CLEAR SCREEN-RAM (ALL PIXELS TO BG-COLOR)
370 VMF 16000,DEC("0F"),8000: REM SETUP ATTRIBUTE-RAM (BLACK/WHITE AS BG/FG COLORS FOR ALL PIXELS)
380 RESTORE

# LORD BRITISH CA 2.5 SECS
390 FAST:S=TI
400 VMF AD,7,8*RW

410 READ I
420 DO WHILE I<>0

# X1:BYTE, X2:BIT
430  X=(I+20)*2

440  READ I
450  Y=191-I

460  X1=INT(X/8)
470  X2=7-(X-X1*8)
480  YP=YL(Y)
490  VMO YP+X1,XL(X2)

500  X=X+2
510  X1=INT(X/8)
520  X2=7-(X-X1*8)
530  VMO YP+X1,XL(X2)

540  READ I
550 LOOP

560 S=TI-S:PRINT "LORD BRITISH: "S" JIFFIES"
570 SLOW

# "AND" - NEEDS TO BE COPIED FROM TITLE.EGA CA DELAYED 1 SEC
#  SCREEN-RAM: ROWS 17-20 = 17*80 - 21*80 = 1360-1680 -> 320 BYTES
#  ATTRIBUTES: ROWS 9-11 = 9*80 - 11*80 = 720-880 -> 160 BYTES
580 VMC PS+1360,PD+1360,320,1,0
590 VMC AS+720,AD+720,160,1,0

# LINE CA 1 SEC DELAY AND 1 SEC DURATION
600 FAST
610 YP=31*RW
620 VMF AD+15*RW,8,RW
630 FOR I=170 TO 475 STEP 2
640  X=I
650  X1=INT(X/8)
660  X2=7-(X-X1*8)
670  VMO YP+X1,XL(X2)

680  X=I+2
690  X1=INT(X/8)
700  X2=7-(X-X1*8)
710  VMO YP+X1,XL(X2)

720 NEXT
730 SLOW

# "ORIGIN SYSTEMS,INC." ABOVE LINE CA 1 SEC
#  SCREEN-RAM: ROWS 21-30 = 1680-2400 -> 720 BYTES
#  ATTRIBUTES: ROWS 10-15 = 800-1200 -> 400 BYTES
#  9 ANIMATION STEPS - 1 STEP ABOUT 6-7 JIFFIES

740 VMF AD+880,3,320

750 I=0

760 TI$="000000"
770 DO

780   IF TI>4 THEN BEGIN
790    VMC PS+21*RW,PD+(21+8-I)*RW,(I+1)*RW,1,0
800    TI$="000000"
810    I=I+1
820   BEND

830 LOOP UNTIL I>8


# "PRESENT" BELOW LINE CA 0.75 SECS
#  SCREEN-RAM: SOURCE=0, DESTINATION=33
#  ATTRIBUTES: SOURCE=0, DESTINATION=16
#  5 ANIMATION STEPS

840 I=0
850 TI$="000000"
860 DO

870  IF TI>4 THEN BEGIN
880   VMC PS+(4-I)*RW,PD+33*RW,(I+1)*RW,1,0

890   TI$="000000"
900   I=I+1
910  BEND

920 LOOP UNTIL I>4


# SAVE "PRESENTS" IN HIDDEN AREA OF VRAM TO NOT LOSE IT WHEN COPYING "ULTIMA IV"
# 136-189=53 FOR 5 ROWS
# DESTINATION: ROW 33-37
930 FOR I=0 TO 4
940  VMC PS+34+I*RW,PS+34+((I+33)*RW),14,1,0
950 NEXT

960 FOR I=0 TO 2
970  VMC AS+34+I*RW,AS+34+((I+16)*RW),14,1,0
980 NEXT

985 SLEEP 4


# "ULTIMA IV" CA 4.5 SECS
#  SCREEN-RAM: SOURCE=33*80, DESTINATION=33*80 -> LENGTH (-79*80) -> 46*80
#  ATTRIBUTES: SOURCE=16*80, DESTINATION=16*80 -> -40*80 -> 24*80
990 VMC PS+33*RW,PD+33*RW,46*RW,1,0
1000 VMC AS+16*RW,AD+16*RW,24*RW,1,0

# "QUEST OF THE AVATAR" CA 0.75 SECS
#  SCREEN-RAM: SOURCE=80*80, LENGTH= 13*80
#  ATTRIBUTES: SOURCE=40*80, LENGTH= 7*80

#  ANIMATION CONSISTS OF 13 LINES
#  DRAW MIDDLE LINE FIRST (6)
#  THEN IN 6 STEPS:
#  0   AND    12 TO 5 AND 7
#  0-1 AND 11-12 TO 4 AND 7
#  0-2 AND 10-12 TO 3 AND 7
#  0-3 AND  9-12 TO 2 AND 7
#  0-4 AND  8-12 TO 1 AND 7
#  0-5 AND  7-12 TO 0 AND 7

# MIDDLE LINE (85)
1010 VMC PS+86*RW,PD+86*RW,RW,1,0
1020 VMC AS+43*RW,AD+43*RW,RW,1,0


1030 FOR I=0 TO 5

#     ABOVE MIDDLE LINE
1040  VMC PS+80*RW,PD+(85-I)*RW,(I+1)*RW,1,0
1050  VMC AS+40*RW,AD+(42-IA(0,I))*RW,IA(0,I)*RW,1,0

#     BELOW MIDDLE LINE
1060  VMC PS+(92-I)*RW,PD+87*RW,RW*(I+1),1,0
1070  VMC AS+(46-IA(1,I))*RW,AD+43*RW,IA(1,I)*RW,1,0



1080 NEXT





1110 SLOW:END

#####

1120 DATA 84,189,85,188,87,188,89,188,91,188,92,189,92,190,91,191
1130 DATA 89,191,88,190,88,189,87,187,86,186,86,185,85,184,85,183
1140 DATA 84,182,84,181,83,180,83,179,82,178,82,177,81,176,79,176
1150 DATA 78,176,77,177,77,178,78,179,80,179,81,178,84,178,85,177
1160 DATA 86,177,87,176,89,176,91,176,93,176,95,176,97,176,99,176
1170 DATA 101,176,103,176,105,176,107,176,109,176,111,176,113,176,115,176
1180 DATA 117,176,119,176,121,176,123,176,125,176,127,176,129,176,131,176
1190 DATA 133,176,135,176,137,176,139,176,141,176,143,176,145,176,147,176
1200 DATA 149,176,151,176,153,176,155,176,157,176,159,176,161,176,163,176
1210 DATA 165,176,167,176,169,176,171,176,173,176,175,176,177,176,179,176
1220 DATA 181,176,183,176,185,176,187,176,189,176,191,176,193,176,195,176
1230 DATA 197,176,199,176,201,176,202,176,203,177,204,177,205,178,94,184
1240 DATA 94,183,93,182,93,181,92,180,92,179,93,178,95,178,96,178
1250 DATA 97,179,97,180,98,181,98,182,99,183,99,184,98,185,96,185
1260 DATA 95,185,105,185,106,184,106,183,105,182,105,181,104,180,104,179
1270 DATA 103,178,107,184,108,185,110,185,119,185,117,185,116,185,115,184
1280 DATA 115,183,114,182,114,181,113,180,113,179,114,178,116,178,117,179
1290 DATA 118,180,119,181,119,182,120,183,120,184,121,185,121,186,122,187
1300 DATA 122,188,123,189,123,190,118,179,119,178,139,190,139,189,138,188
1310 DATA 138,187,137,186,137,185,136,184,136,183,135,182,135,181,134,180
1320 DATA 134,179,133,178,140,191,142,191,143,191,144,190,144,189,143,188
1330 DATA 143,187,142,186,142,185,140,185,143,184,143,183,142,182,142,181
1340 DATA 141,180,141,179,140,178,138,178,136,178,135,179,150,185,151,184
1350 DATA 151,183,150,182,150,181,149,180,149,179,148,178,152,184,153,185
1360 DATA 155,185,161,185,160,184,160,183,159,182,159,181,158,180,158,179
1370 DATA 157,178,162,188,162,187,169,188,169,187,168,186,168,185,167,184
1380 DATA 167,183,166,182,166,181,165,180,165,179,166,178,168,178,169,178
1390 DATA 170,179,165,185,166,185,170,185,178,185,177,184,177,183,176,182
1400 DATA 176,181,175,180,175,179,174,178,179,188,179,187,187,184,186,185
1410 DATA 184,185,183,185,182,184,182,183,183,182,184,181,185,180,185,179
1420 DATA 184,178,182,178,181,178,180,179,197,190,197,189,196,188,196,187
1430 DATA 195,186,195,185,194,184,194,183,193,182,193,181,192,180,192,179
1440 DATA 191,178,197,185,198,185,199,184,199,183,198,182,198,181,197,180
1450 DATA 197,179,198,178,0